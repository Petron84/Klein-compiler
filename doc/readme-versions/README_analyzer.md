# **Klein Compiler - Module 4: Semantic Analyzer and Symbol Table**

## **Team Name: Kleithon** 
Members: Phat Nguyen, Efrata Tesfaye, Ziad Ouro-Koura, Dylan Bock  

---

## **Overview**

Module 4 extends our Klein compiler by adding:
1. A **Semantic Analyzer** that verifies program correctness and enforces Klein's language rules.  
2. **Kleinv** which outputs a symbol table recording all functions, returntypes, function parameters, and function relationships.  

This stage completes the semantic phase of the compiler and provides advanced validation and visualization tools to help developers debug Klein programs.

---

## **Core Features**

-  Comprehensive **semantic checking** for all valid and invalid Klein programs.  
-  Reports both **semantic errors** and **semantic warnings**.  
-  Detects:
  - Invalid or duplicate function definitions  
  - Missing `main()`  
  - Invalid return types or argument mismatches  
  - Undefined identifiers  
  - Unused parameters and functions  
  - Unreachable or redundant branches (redundant defined as expressions with maximum depth = 2)
  - **Infinite recursion** (newly implemented)  
-  Generates `.dot` and `.png` ASTs automatically in `doc/GraphOutputs/`.  
-  Fully integrated with the `kleinv` command-line tool.  

---

## **Implemented Optional Features**

All optional features described in the Module 4 specification are now implemented, including:

| Feature | Status |
|----------|---------|
| Unused function detection |  
| Unused parameter detection |  
| Unreachable clause detection in `if` expressions |  
| Redundant function detection |  
| Infinite recursion detection | 

Each of these generates **semantic warnings** rather than fatal errors, allowing valid programs to run while informing the user of potential issues.

---

## **Core Components**

| File | Description |
|------|--------------|
| `semantic_analyzer.py` | Performs semantic validation, builds the symbol table, and raises semantic errors and warnings. |
| `validate_semanticparser.py` | Combines parsing and semantic analysis for testing. |
| `DOTGenerator.py` | Generates `.dot` and `.png` files for AST visualization. |
| `AST_Creator.py` | Defines the `TreeNode` class for building AST structures. |
| `kleinv` | Command-line tool that runs the parser, analyzer, and DOT generator. |
| `tableloader.py` | Provides parser table logic integrated with semantic actions. |
| `token_lister.py` | Utility for token stream inspection and debugging. |

---

## **Semantic Analyzer (`semantic_analyzer.py`)**

The **Analyzer** and **Traverser** classes traverse the AST to check semantic rules and build the symbol table.

### **Key Responsibilities**
- Validate all function definitions, parameter declarations, and return types.  
- Check scope and type correctness for every identifier.  
- Ensure function calls match expected argument counts and types.  
- Track call relationships and detect unused or recursive functions.  
- Build a complete **symbol table** with:
  - Function name  
  - Return type  
  - Parameters (name, type, used/unused flag)  
  - Functions called  
  - Functions that call it  

---

### **Semantic Errors vs. Warnings**

#### **Semantic Errors**
Critical violations that make a program invalid, such as:
- Missing `main()` or duplicate function definitions  
- Mismatched argument or return types  
- Use of undefined identifiers  
- Invalid operator/operand combinations  

#### **Semantic Warnings**
Issues that don't invalidate the program but indicate poor structure or potential problems:
- Unused parameters or functions  

- Unreachable `if` branches or redundant code  
- Hardcoded constant conditions  
- Infinite recursion detection  
- Style and optimization hints  

All optional warnings are implemented and demonstrated in **`semantic-errors.kln`**, where they are labeled as **OPTIONAL**.
---
The **DOT generator** converts ASTs into `.dot` graphs and `.png` images using Graphviz.

## **DOT Generator (`DOTGenerator.py`)**


### **Output Location**
All abstract syntax trees (ASTs) generated by the parser are exported to DOT and PNG format in doc/GraphOutputs/

### **Example Files**
average-digit_AST.dot
average-digit_AST.png

These represent the visualized AST for the Klein program `average-digit.kln`.  
Each node shows the construct type and (if applicable) its value.  
For instance, the first few lines of the DOT graph show the structure of the program:

**Example Preview (first few lines of DOT file):**
```plaintext
digraph AST{
  node0 [label="PROGRAM"]
  node1 [label="DEFINITION-LIST"]
  node2 [label="DEFINITION"]
  node3 [label="IDENTIFIER\nMOD"]
  ...
  }
```
---

## **How to Run**
Command-Line Usage:
```bash
./kleinv [PATH_TO_KLEIN_FILE_OR_DIRECTORY]
```
---

### **Examples**

Run a single Klein program:
```bash
./kleinv programs/two-primes.kln
```

Run an entire directory:
```bash
./kleinv programs/semantic-tests/
```

---

## **Expected Output:**

1. Validation Results:

"Valid Program" for correct programs.
"Klein Error: .." for invalid programs.


2. Symbol Table:

Lists all functions, parameters, return types, and relationships.

3. Graph Outputs:

.dot and .png ASTs in doc/GraphOutputs/.

---

## **Symbol Table Example**

Function: emirp
  Type: boolean
  Parameters: n: integer
  Calls: isPrime, reverse
  Called By: doBoth, main

Function: snowball
  Type: boolean
  Parameters: n: integer
  Calls: isPrime
  Called By: main

Function: doBoth
  Type: boolean
  Parameters: n: integer
  Calls: emirp, snowball, print
  Called By: main

Function: main
  Type: boolean
  Parameters: n: integer, selector: integer
  Calls: emirp, snowball, doBoth
  Called By: (none)

Function: isPrime
  Type: boolean
  Parameters: n: integer
  Calls: hasDivisorFrom
  Called By: emirp, snowball

Function: hasDivisorFrom
  Type: boolean
  Parameters: i: integer, n: integer
  Calls: divides, hasDivisorFrom
  Called By: isPrime

Function: divides
  Type: boolean
  Parameters: a: integer, b: integer
  Calls: MOD
  Called By: hasDivisorFrom

Function: reverse
  Type: integer
  Parameters: n: integer
  Calls: reverseL
  Called By: emirp

Function: reverseL
  Type: integer
  Parameters: n: integer, nR: integer
  Calls: reverseL
  Called By: reverse

Function: MOD
  Type: integer
  Parameters: m: integer, n: integer
  Calls: (none)
  Called By: divides

---

## **Semantic Error & Warning Examples**
**Errors*
Semantic Error: Missing function 'main'
Semantic Error: Duplicate definition of function 'foo'
Semantic Error: Identifier 'x' undefined in scope
Semantic Error: Function 'emirp' returns integer, expected boolean

**Warnings*
Semantic Warning: The function helper was never called.
Semantic Warning: The function divides contains parameter b, but it was never used.
Semantic Warning: If expression in snowball always evaluates to true - else clause unreachable.
Semantic Warning: Infinite recursion detected in function reverseL.

## **Test Programs**
File	Purpose
semantic-errors.kln	Demonstrates all semantic error and warning cases (including OPTIONAL warnings).

semantic-fixed.kln	Corrected version that passes all semantic checks.
two-primes.kln	Complex valid Klein program combining emirp and snowball number detection with recursion and arithmetic.
Analyzer outputs and symbol tables are saved to:
```bash
doc/semantic-errors-output.txt
```

Directory Structure
Compiler-Tools/
  kleinv
  semantic_analyzer.py
  DOTGenerator.py
  AST_Creator.py
  validate_semanticparser.py
  parser.py
  tableloader.py
  token_lister.py
programs/
  semantic-errors.kln
  semantic-fixed.kln
  legal-programs/
  illegal-programs/
  two-primes.kln
doc/
  GraphOutputs/
    average-digit_AST.dot
    average-digit_AST.png
  semantic-errors-output.txt
  abstract_syntax.md
  status_check.pdf

## **Project Structure**

```
  kleinp                # Script to run the AST printer
  kleinf                # Parser from Module 2 (kept for reference)
  kleins
  kleinv                
  README.md
doc/
  GraphOutputs/
    average-digit_AST.dot
    average-digit_AST.png
  old-document-versions/
  readme-versions/
  semantic-errors.kln
  semantic-bugfixes.kln

   
```
programs/
  legal-programs/
    sumprime.kln      
    two-primes.kln
  illegal-programs/
    ...                 # Test programs that trigger syntax errors
    
src/
  parser.py             # Updated parser with semantic actions
  tableloader.py        # Updated with semantic rule integration
  AST_Creator.py        # Builds Abstract Syntax Trees
  DOTGenerator.py       # Exports AST as .dot and .png files
  scanner.py
  token_lister.py
  semantic_analyzer.py
  validate_semanticparser.py

---

## **Deliverables**

semantic_analyzer.py

kleinv

semantic-errors.kln / semantic-fixed.kln

two-primes.kln

doc/semantic-errors-output.txt



## **Final Status**

All required and optional semantic analysis features implemented.
Automatic AST graph generation and output directory complete.
infinite recursion detection successfully added.
Complex valid test program (two-primes.kln) verified successfully.
Graph outputs (average-digit_AST.dot, .png) validated.


